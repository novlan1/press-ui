(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-press-signature-signature"],{"12b9":function(t,e,n){"use strict";function a(t){return Object.assign(t,{setStrokeStyle:function(e){t.strokeStyle=e},setLineWidth:function(e){t.lineWidth=e},setLineCap:function(e){t.lineCap=e},setFillStyle:function(e){t.fillStyle=e},setFontSize:function(e){t.font=String(e)},setGlobalAlpha:function(e){t.globalAlpha=e},setLineJoin:function(e){t.lineJoin=e},setTextAlign:function(e){t.textAlign=e},setMiterLimit:function(e){t.miterLimit=e},setShadow:function(e,n,a,i){t.shadowOffsetX=e,t.shadowOffsetY=n,t.shadowBlur=a,t.shadowColor=i},setTextBaseline:function(e){t.textBaseline=e},createCircularGradient:function(){},draw:function(){}})}n("c7ef"),Object.defineProperty(e,"__esModule",{value:!0}),e.adaptor=a},"26bd":function(t,e,n){"use strict";var a;n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){return a}));var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"press-signature",class:t.customClass},[n("div",{ref:"wrapRef",staticClass:"press-signature__content",attrs:{id:t.wrapId}},[t.isRenderCanvas?n("Canvas",{ref:"canvasRef",attrs:{id:t.canvasId,type:"2d","canvas-id":t.canvasId},on:{"&touchstart":function(e){arguments[0]=e=t.$handleEvent(e),t.touchStart.apply(void 0,arguments)},touchmove:function(e){e.preventDefault(),e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.touchMove.apply(void 0,arguments)},touchend:function(e){e.preventDefault(),e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.touchEnd.apply(void 0,arguments)}}}):n("p",[t._v(t._s(t.tips))])],1),n("div",{staticClass:"press-signature__footer"},[n("PressButton",{attrs:{"custom-class":"press-signature__button press-signature__button--clear",size:"small"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.clear.apply(void 0,arguments)}}},[t._v(t._s(t.clearButtonText||t.t("clear")))]),n("PressButton",{attrs:{"custom-class":"press-signature__button press-signature__submit",type:"primary",size:"small"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.submit.apply(void 0,arguments)}}},[t._v(t._s(t.confirmButtonText||t.t("confirm")))])],1)])},s=[]},"2ab2":function(t,e,n){"use strict";n("c7ef");var a=n("de9e").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,n("12c6"),n("aa72"),n("92cd"),n("8fa8"),n("e70a");var i=a(n("5246")),s=n("dc16"),r=n("d4e4"),o=n("db02"),c=n("12ef"),u=n("4609"),d=n("12b9"),l=n("4e6a"),f=function(){var t,e=document.createElement("canvas");return!(null===(t=e.getContext)||void 0===t||!t.call(e,"2d"))},h=0;e.default={name:"PressSignature",components:{PressButton:i.default},options:{styleIsolation:"shared"},props:{customClass:{type:String,default:""},tips:{type:String,default:""},type:{type:String,default:""},penColor:{type:String,default:"#000"},lineWidth:{type:Number,default:3},backgroundColor:{type:String,default:"#fff"},clearButtonText:{type:String,default:(0,o.t)("clear")},confirmButtonText:{type:String,default:(0,o.t)("confirm")}},emits:["start","signing","end","submit","clear"],data:function(){return{canvasRect:{},canvasWidth:0,canvasHeight:0,id:1,inited:!1,ctx:null,wrapId:"pressSignatureWrap",currentLine:[],lastPoint:{},currentPoint:{},firstTouch:!0,cutArea:{},radius:1,canvas:null}},computed:{canvasId:function(){var t="press-signature-".concat(this.id);return t},isRenderCanvas:function(){var t=!0;return t=!r.IN_BROWSER||f(),t},useRawCanvas:function(){var t=!1;return t=!0,(0,c.isNotInUni)()&&(t=!0),t}},watch:{windowWidth:function(){this.resize()}},created:function(){h+=1,this.id=h},mounted:function(){this.initialize()},methods:{touchStart:function(t){var e=this;if(!this.ctx)return!1;this.useRawCanvas?(this.ctx.beginPath(),this.ctx.setLineWidth(this.lineWidth),this.ctx.setStrokeStyle(this.penColor)):this.updateCurrentLine(t,!0),(0,s.getRect)(this,"#".concat(this.canvasId)).then((function(t){e.canvasRect=t,e.$emit("start")}))},pointToLine:function(t){var e=this,n=(0,l.calcBethelLine)(this.ctx,t,{lineColor:this.penColor,updateRadius:function(t){e.radius=t},radius:this.radius,lineWidth:this.lineWidth,penColor:this.penColor});n&&(this.currentLine=n)},updateCurrentLine:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={x:t.changedTouches[0].x,y:t.changedTouches[0].y};this.lastPoint=this.currentPoint,this.currentPoint=n;var a=this.currentLine;a.unshift({time:(new Date).getTime(),dis:e?0:(0,l.distance)(this.currentPoint,this.lastPoint),x:n.x,y:n.y}),this.pointToLine(a)},touchMove:function(t){var e,n;if(!this.ctx)return!1;if(null===(e=t.preventDefault)||void 0===e||e.call(t),null===(n=t.stopPropagation)||void 0===n||n.call(t),this.useRawCanvas){var a,i,s=t.touches[0],r=s.clientX-((null===(a=this.canvasRect)||void 0===a?void 0:a.left)||0),o=s.clientY-((null===(i=this.canvasRect)||void 0===i?void 0:i.top)||0);this.ctx.setLineCap("round"),this.ctx.setLineJoin("round"),this.ctx.lineTo(r,o),this.ctx.stroke()}else this.updateCurrentLine(t);this.$emit("signing",t)},touchEnd:function(t){var e;null===(e=t.preventDefault)||void 0===e||e.call(t),this.$emit("end"),this.useRawCanvas||(this.updateCurrentLine(t),this.currentLine=[])},submit:function(){var t=this,e=this;if(this.useRawCanvas){var n,a,i=this.$refs.canvasRef;if(!i)return;var s=this.isCanvasEmpty(i),r=s?"":(null===(n=(a={jpg:function(){return i.toDataURL("image/jpeg",.8)},jpeg:function(){return i.toDataURL("image/jpeg",.8)}})[this.type])||void 0===n?void 0:n.call(a))||i.toDataURL("image/".concat(this.type));this.$emit("submit",{image:r,canvas:i,width:this.canvasWidth,height:this.canvasHeight})}else{var o=function(){uni.canvasToTempFilePath({canvas:t.canvas,fileType:"jpg",quality:1,success:function(t){var n=t.tempFilePath;e.base64(n,"jpg").then((function(t){e.$emit("submit",{image:t,canvas:e.canvas,width:e.canvasWidth,height:e.canvasHeight})}))},fail:function(){}})};o()}},base64:function(t,e){return new Promise((function(n,a){uni.getFileSystemManager().readFile({filePath:t,encoding:"base64",success:function(t){n("data:image/".concat(e.toLocaleLowerCase(),";base64,").concat(t.data))},fail:function(){a()}})}))},clear:function(){this.ctx&&(this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.ctx.closePath(),this.ctx.draw(),this.setCanvasBgColor(this.ctx)),this.$emit("clear")},initialize:function(){var t=this;this.isRenderCanvas&&this.getContext().then((function(e){t.ctx=e,t.setCanvasBgColor(t.ctx)}))},getContext:function(){var t=this,e=this;return new Promise((function(n,a){(0,s.getRect)(t,"#".concat(t.wrapId)).then((function(t){var a=t.width,i=t.height;e.canvasWidth=a,e.canvasHeight=i;var s=e.innerGetContext({width:a,height:i});n(s)})).catch((function(t){a(t)}))}))},innerGetContext:function(t){var e=this,n=t.width,a=t.height,i=function(){var t=window.devicePixelRatio,i=document.getElementById(e.canvasId),s=i.getContext("2d");return e.inited||(e.inited=!0,i.width=n*t,i.height=a*t,s.scale(t,t)),Promise.resolve((0,d.adaptor)(s))};if(this.useRawCanvas)return i();if(!(0,u.canIUseCanvas2d)()){var s=uni.createCanvasContext(this.canvasId,this);return Promise.resolve(s)}var r=(0,u.getWindowInfo)().pixelRatio;return new Promise((function(t){uni.createSelectorQuery().in(e).select("#".concat(e.canvasId)).node().exec((function(i){var s=i[0].node;e.canvas=s;var o=s.getContext("2d");e.inited||(e.inited=!0,s.width=n*r,s.height=a*r,o.scale(r,r)),t((0,d.adaptor)(o))}))}))},resize:function(){if(this.ctx){var t=this.ctx.getImageData(0,0,this.canvasWidth,this.canvasHeight);this.initialize(),this.ctx.putImageData(t,0,0)}},isCanvasEmpty:function(t){var e=document.createElement("canvas");if(e.width=t.width,e.height=t.height,this.backgroundColor){var n=e.getContext("2d");this.setCanvasBgColor(n)}return t.toDataURL()===e.toDataURL()},setCanvasBgColor:function(t){var e,n;t&&this.backgroundColor&&(t.fillStyle=this.backgroundColor,null===(e=t.setFillStyle)||void 0===e||e.call(t,this.backgroundColor),t.fillRect(0,0,this.canvasWidth,this.canvasHeight),null===(n=t.draw)||void 0===n||n.call(t))},t:o.t}}},"2fa5":function(t,e,n){"use strict";var a;n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){return a}));var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"demo-wrap"},[n("demo-block",{attrs:{title:t.t("basicUsage"),"section-style":t.sectionStyle,"custom-style":t.customStyle}},[n("PressSignature",{ref:"pressSignature",attrs:{"pen-color":t.customInfo["pen-color"],"line-width":t.customInfo["line-width"],"background-color":t.customInfo["background-color"]},on:{submit:function(e){arguments[0]=e=t.$handleEvent(e),t.onSubmit.apply(void 0,arguments)},clear:function(e){arguments[0]=e=t.$handleEvent(e),t.onClear.apply(void 0,arguments)}}}),n("div",{staticClass:"image-wrap"},[t.image?n("PressImage",{attrs:{src:t.image,width:t.canvasWidth,height:t.canvasHeight}}):t._e()],1)],1),n("PressGrid",{attrs:{clickable:!0,"column-num":3}},[n("PressGridItem",{attrs:{text:t.t("penColor"),icon:"edit"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.custom({"pen-color":"#ff0000"})}}}),n("PressGridItem",{attrs:{text:t.t("lineWidth"),icon:"font-o"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.custom({"line-width":6})}}}),n("PressGridItem",{attrs:{text:t.t("backgroundColor"),icon:"photo-o"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.custom({"background-color":"#eee"})}}})],1)],1)},s=[]},4283:function(t,e,n){"use strict";n.r(e);var a=n("26bd"),i=n("e168");for(var s in i)["default"].indexOf(s)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(s);n("498b");var r,o=n("921e"),c=Object(o["a"])(i["default"],a["b"],a["c"],!1,null,"6a1798ce",null,!1,a["a"],r);e["default"]=c.exports},"498b":function(t,e,n){"use strict";var a=n("5027"),i=n.n(a);i.a},"4bd6":function(t,e,n){var a=n("a8d8");e=a(!1),e.push([t.i,".demo-wrap[data-v-d1f4a514]{max-height:calc(100vh - 100px)}.image-wrap[data-v-d1f4a514]{padding:0 8px}",""]),t.exports=e},"4e6a":function(t,e,n){"use strict";function a(t,e,n){var a=n.lineColor,o=void 0===a?"#1A1A1A":a,c=n.updateRadius,u=n.radius,d=u,l=60,f=1,h=1.5,v=.5,p=4;if(!(e.length<=1)){var g,x,m,y,b,C,w=0,_=0,S=.5;e.length<=2?(g=e[1].x,y=e[1].y,m=e[1].x+(e[0].x-e[1].x)*S,C=e[1].y+(e[0].y-e[1].y)*S,x=g+(m-g)*S,b=y+(C-y)*S):(g=e[2].x+(e[1].x-e[2].x)*S,y=e[2].y+(e[1].y-e[2].y)*S,x=e[1].x,b=e[1].y,m=x+(e[0].x-x)*S,C=b+(e[0].y-b)*S);for(var P=i({x:m,y:C},{x:g,y:y}),k=d,R=0;R<e.length-1;R++)if(w+=e[R].dis,_+=e[R].time-e[R+1].time,w>l)break;d=Math.min(_/P*f+v,p)*h,c(d),e[0].r=d;for(var I=5,L=[],F=0;F<I;F++){var W=F/(I-1),E=(1-W)*(1-W)*g+2*W*(1-W)*x+W*W*m,$=(1-W)*(1-W)*y+2*W*(1-W)*b+W*W*C,B=k+(d-k)/I*F;if(L.push({x:E,y:$,r:B}),3==L.length){var T=s(L[0].x,L[0].y,L[0].r,L[1].x,L[1].y,L[1].r,L[2].x,L[2].y,L[2].r);T[0].color=o,r(t,T,1),L=[{x:E,y:$,r:B}]}}return e}e[0].r=d}function i(t,e){var n=e.x-t.x,a=e.y-t.y;return Math.sqrt(n*n+a*a)}function s(t,e,n,a,i,s,r,o,c){var u,d,l,f,h,v=[];u=a-t,d=i-e,l=2*Math.sqrt(u*u+d*d+1e-4),u=u/l*n,d=d/l*n;var p=d,g=-u;f=a-r,h=i-o,l=2*Math.sqrt(f*f+h*h+1e-4),f=f/l*c,h=h/l*c;var x=-h,m=f;v.push({mx:t+p,my:e+g,color:"#1A1A1A"}),v.push({c1x:a+p,c1y:i+g,c2x:a+x,c2y:i+m,ex:r+x,ey:o+m}),v.push({c1x:r+x-f,c1y:o+m-h,c2x:r-x-f,c2y:o-m-h,ex:r-x,ey:o-m}),v.push({c1x:a-x,c1y:i-m,c2x:a-p,c2y:i-g,ex:t-p,ey:e-g}),v.push({c1x:t-p-u,c1y:e-g-d,c2x:t+p-u,c2y:e+g-d,ex:t+p,ey:e+g}),v[0].mx=v[0].mx.toFixed(1),v[0].mx=parseFloat(v[0].mx),v[0].my=v[0].my.toFixed(1),v[0].my=parseFloat(v[0].my);for(var y=1;y<v.length;y++)v[y].c1x=v[y].c1x.toFixed(1),v[y].c1x=parseFloat(v[y].c1x),v[y].c1y=v[y].c1y.toFixed(1),v[y].c1y=parseFloat(v[y].c1y),v[y].c2x=v[y].c2x.toFixed(1),v[y].c2x=parseFloat(v[y].c2x),v[y].c2y=v[y].c2y.toFixed(1),v[y].c2y=parseFloat(v[y].c2y),v[y].ex=v[y].ex.toFixed(1),v[y].ex=parseFloat(v[y].ex),v[y].ey=v[y].ey.toFixed(1),v[y].ey=parseFloat(v[y].ey);return v}function r(t,e,n,a){t.beginPath(),t.moveTo(e[0].mx,e[0].my),void 0!=a?(t.setFillStyle(a),t.setStrokeStyle(a)):(t.setFillStyle(e[0].color),t.setStrokeStyle(e[0].color));for(var i=1;i<e.length;i++)t.bezierCurveTo(e[i].c1x,e[i].c1y,e[i].c2x,e[i].c2y,e[i].ex,e[i].ey);t.stroke(),void 0!=n&&t.fill(),t.draw(!0)}n("c7ef"),Object.defineProperty(e,"__esModule",{value:!0}),e.bethelDraw=r,e.calcBethelLine=a,e.ctaCalc=s,e.distance=i,n("6e46"),n("0892"),n("8349")},5027:function(t,e,n){var a=n("7e38");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var i=n("5a15").default;i("27ec3472",a,!0,{sourceMap:!1,shadowMode:!1})},"6e46":function(t,e,n){"use strict";var a=n("d1a9"),i=n("342d"),s=n("0428");a({target:"Array",proto:!0},{fill:i}),s("fill")},"7bde":function(t,e,n){"use strict";n.r(e);var a=n("dd59"),i=n.n(a);for(var s in a)["default"].indexOf(s)<0&&function(t){n.d(e,t,(function(){return a[t]}))}(s);e["default"]=i.a},"7e38":function(t,e,n){var a=n("a8d8");e=a(!1),e.push([t.i,".press-signature[data-v-6a1798ce]{padding:var(--press-signature-padding,var(--press-padding-xs,8px))}.press-signature__content[data-v-6a1798ce]{display:flex;justify-content:center;align-items:center;height:var(--press-signature-content-height,200px);background-color:var(--press-signature-content-background,var(--press-background-2,#fff));border:var(--press-signature-content-border,1px dotted #dadada);border-radius:var(--press-radius-lg,8px);overflow:hidden}.press-signature__content uni-canvas[data-v-6a1798ce],.press-signature__content Canvas[data-v-6a1798ce]{width:100%;height:100%}.press-signature__footer[data-v-6a1798ce]{display:flex;justify-content:flex-end}.press-signature__footer .press-button[data-v-6a1798ce],.press-signature__footer[data-v-6a1798ce]  .press-signature__button{padding:0 var(--press-padding-md,12px);margin:var(--press-padding-xs,8px)}",""]),t.exports=e},a110:function(t,e,n){"use strict";var a=n("fe83"),i=n.n(a);i.a},dd59:function(t,e,n){"use strict";(function(t){n("c7ef");var a=n("de9e").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a(n("6d7c")),s=a(n("4283")),r=a(n("1512")),o=a(n("49d6")),c=a(n("7534")),u={"pen-color":"#000","line-width":3,"background-color":"#fff"};e.default={i18n:{"zh-CN":{penColor:"自定义颜色",lineWidth:"自定义线宽",backgroundColor:"自定义背景颜色"},"en-US":{penColor:"Pen Color",lineWidth:"Line Width",backgroundColor:"Background Color"}},components:{PressSignature:s.default,PressImage:r.default,PressGrid:o.default,PressGridItem:c.default},data:function(){return{image:"",canvasWidth:"calc(100vw - 16px)",canvasHeight:200,customStyle:"background: transparent",sectionStyle:"padding: 0 0",customInfo:(0,i.default)({},u)}},methods:{onSubmit:function(e){t.log("[onSubmit]",e);var n=e.image,a=e.width,i=e.height;this.image=n,this.canvasWidth=a,this.canvasHeight=i},onClear:function(){},custom:function(t){var e=this;this.customInfo=(0,i.default)((0,i.default)({},u),t),setTimeout((function(){e.$refs.pressSignature.clear()}))}}}}).call(this,n("44fd")["default"])},e168:function(t,e,n){"use strict";n.r(e);var a=n("2ab2"),i=n.n(a);for(var s in a)["default"].indexOf(s)<0&&function(t){n.d(e,t,(function(){return a[t]}))}(s);e["default"]=i.a},e4b8:function(t,e,n){"use strict";n.r(e);var a=n("2fa5"),i=n("7bde");for(var s in i)["default"].indexOf(s)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(s);n("a110");var r,o=n("921e"),c=Object(o["a"])(i["default"],a["b"],a["c"],!1,null,"d1f4a514",null,!1,a["a"],r);e["default"]=c.exports},fe83:function(t,e,n){var a=n("4bd6");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var i=n("5a15").default;i("ddd7ff94",a,!0,{sourceMap:!1,shadowMode:!1})}}]);